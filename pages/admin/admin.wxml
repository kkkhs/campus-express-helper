<view class="container">
  <!-- æ ‡ç­¾æ  -->
  <view class="admin-tabs">
    <view 
      wx:for="{{tabs}}" 
      wx:key="key"
      class="tab-item {{activeTab === item.key ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="{{item.key}}"
    >
      <text class="tab-text">{{item.name}}</text>
    </view>
  </view>

  <!-- ç”¨æˆ·ç®¡ç† -->
  <view wx:if="{{activeTab === 'users'}}" class="content-section">
    <scroll-view scroll-y class="content-list" refresher-enabled refresher-triggered="{{loading}}" bindrefresherrefresh="onPullDownRefresh">
      <view wx:if="{{users.length === 0 && !loading}}" class="empty-state">
        <text class="empty-icon">ğŸ‘¥</text>
        <text class="empty-text">æš‚æ— ç”¨æˆ·æ•°æ®</text>
      </view>

      <view wx:for="{{users}}" wx:key="_id" class="user-item">
        <view class="user-info">
          <image class="avatar" src="{{item.avatar || '/images/default-avatar.png'}}" />
          <view class="user-details">
            <text class="nickname">{{item.nickname || 'åŒ¿åç”¨æˆ·'}}</text>
            <text class="join-time">æ³¨å†Œæ—¶é—´ï¼š{{item.createTimeText}}</text>
            <text class="rating">â­{{item.rating || '5.0'}}</text>
          </view>
        </view>
        <view class="user-actions">
          <text class="user-status {{item.banned ? 'banned' : 'normal'}}">
            {{item.banned ? 'å·²å°ç¦' : 'æ­£å¸¸'}}
          </text>
          <button 
            class="btn-ban {{item.banned ? 'btn-unban' : ''}}"
            bindtap="toggleUserBan"
            data-user-id="{{item._id}}"
            data-banned="{{item.banned}}"
          >
            {{item.banned ? 'è§£å°' : 'å°ç¦'}}
          </button>
        </view>
      </view>

      <view wx:if="{{loading && users.length > 0}}" class="loading-more">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
    </scroll-view>
  </view>

  <!-- ä»»åŠ¡ç®¡ç† -->
  <view wx:if="{{activeTab === 'tasks'}}" class="content-section">
    <scroll-view scroll-y class="content-list" refresher-enabled refresher-triggered="{{loading}}" bindrefresherrefresh="onPullDownRefresh">
      <view wx:if="{{tasks.length === 0 && !loading}}" class="empty-state">
        <text class="empty-icon">ğŸ“‹</text>
        <text class="empty-text">æš‚æ— ä»»åŠ¡æ•°æ®</text>
      </view>

      <view wx:for="{{tasks}}" wx:key="_id" class="task-item">
        <view class="task-header">
          <view class="task-info">
            <text class="task-time">{{formatTime(item.createTime)}}</text>
            <view class="status-badge" style="color: {{item.status === 'pending' ? '#ff7d00' : item.status === 'accepted' ? '#1890ff' : item.status === 'completed' ? '#52c41a' : '#999'}}; background: {{item.status === 'pending' ? '#fff7e6' : item.status === 'accepted' ? '#e6f7ff' : item.status === 'completed' ? '#f6ffed' : '#f5f5f5'}};">
              {{item.status === 'pending' ? 'å¾…æ¥å•' : item.status === 'accepted' ? 'å·²æ¥å•' : item.status === 'completed' ? 'å·²å®Œæˆ' : 'å·²å–æ¶ˆ'}}
            </view>
          </view>
          <view class="reward">Â¥{{item.reward}}</view>
        </view>

        <view class="task-content" bindtap="viewTaskDetail" data-task-id="{{item._id}}">
          <view class="pickup-info">
            <text class="pickup-point">{{item.pickupPoint === 'south' ? 'å—åŒº' : 'åŒ—åŒº'}}</text>
            <text class="company">{{item.company}}</text>
          </view>
          <view class="pickup-code">å–ä»¶ç ï¼š{{item.pickupCode}}</view>
          <view class="publisher-info">
            <text class="label">å‘å¸ƒè€…ï¼š</text>
            <text class="publisher-name">{{item.publisher.nickname}}</text>
          </view>
        </view>
      </view>

      <view wx:if="{{loading && tasks.length > 0}}" class="loading-more">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
    </scroll-view>
  </view>

  <!-- æŠ•è¯‰ç®¡ç† -->
  <view wx:if="{{activeTab === 'complaints'}}" class="content-section">
    <scroll-view scroll-y class="content-list" refresher-enabled refresher-triggered="{{loading}}" bindrefresherrefresh="onPullDownRefresh">
      <view wx:if="{{complaints.length === 0 && !loading}}" class="empty-state">
        <text class="empty-icon">âš ï¸</text>
        <text class="empty-text">æš‚æ— æŠ•è¯‰æ•°æ®</text>
      </view>

      <view wx:for="{{complaints}}" wx:key="_id" class="complaint-item">
        <view class="complaint-header">
          <text class="complaint-time">{{formatTime(item.createTime)}}</text>
          <view class="status-badge {{item.status === 'pending' ? 'pending' : item.status === 'resolved' ? 'resolved' : 'rejected'}}">
            {{item.status === 'pending' ? 'å¾…å¤„ç†' : item.status === 'resolved' ? 'å·²è§£å†³' : 'å·²é©³å›'}}
          </view>
        </view>

        <view class="complaint-content">
          <view class="complaint-info">
            <text class="label">æŠ•è¯‰äººï¼š</text>
            <text class="complainant">{{item.complainant.nickname}}</text>
          </view>
          <view class="complaint-info">
            <text class="label">è¢«æŠ•è¯‰äººï¼š</text>
            <text class="respondent">{{item.respondent.nickname}}</text>
          </view>
          <view class="complaint-reason">
            <text class="label">æŠ•è¯‰åŸå› ï¼š</text>
            <text class="reason-text">{{item.reason}}</text>
          </view>
          <view class="complaint-description" wx:if="{{item.description}}">
            <text class="label">è¯¦ç»†æè¿°ï¼š</text>
            <text class="description-text">{{item.description}}</text>
          </view>
        </view>

        <view class="complaint-actions" wx:if="{{item.status === 'pending'}}">
          <button 
            class="btn-resolve"
            bindtap="handleComplaint"
            data-complaint-id="{{item._id}}"
            data-action="resolve"
          >
            æ ‡è®°å·²è§£å†³
          </button>
          <button 
            class="btn-reject"
            bindtap="handleComplaint"
            data-complaint-id="{{item._id}}"
            data-action="reject"
          >
            é©³å›æŠ•è¯‰
          </button>
        </view>
      </view>

      <view wx:if="{{loading && complaints.length > 0}}" class="loading-more">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
    </scroll-view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡ -->
  <view wx:if="{{activeTab === 'statistics'}}" class="content-section">
    <view class="statistics-container">
      <view class="stat-card">
        <view class="stat-icon">ğŸ‘¥</view>
        <view class="stat-info">
          <text class="stat-number">{{statistics.totalUsers}}</text>
          <text class="stat-label">æ€»ç”¨æˆ·æ•°</text>
        </view>
      </view>

      <view class="stat-card">
        <view class="stat-icon">ğŸ“‹</view>
        <view class="stat-info">
          <text class="stat-number">{{statistics.totalTasks}}</text>
          <text class="stat-label">æ€»ä»»åŠ¡æ•°</text>
        </view>
      </view>

      <view class="stat-card">
        <view class="stat-icon">âœ…</view>
        <view class="stat-info">
          <text class="stat-number">{{statistics.completedTasks}}</text>
          <text class="stat-label">å·²å®Œæˆä»»åŠ¡</text>
        </view>
      </view>

      <view class="stat-card">
        <view class="stat-icon">âš ï¸</view>
        <view class="stat-info">
          <text class="stat-number">{{statistics.pendingComplaints}}</text>
          <text class="stat-label">å¾…å¤„ç†æŠ•è¯‰</text>
        </view>
      </view>
    </view>
  </view>
</view>
