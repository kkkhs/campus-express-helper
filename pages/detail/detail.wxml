<view class="container">
  <view wx:if="{{!task}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <view wx:else class="content">
    <!-- ä»»åŠ¡çŠ¶æ€ -->
    <view class="status-header">
      <text class="status-tag status-{{task.status}}">{{statusText}}</text>
      <text class="reward">é…¬åŠ³ Â¥{{task.reward}}</text>
    </view>

    <!-- ä»»åŠ¡ä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">å¿«é€’ä¿¡æ¯</view>
      
      <view class="info-item">
        <text class="label">å¿«é€’ç‚¹ï¼š</text>
        <text class="value">{{task.pickupPoint}}</text>
      </view>
      
      <view class="info-item">
        <text class="label">å¿«é€’å…¬å¸ï¼š</text>
        <text class="value">{{task.company}}</text>
      </view>
      
      <view class="info-item">
        <text class="label">å–ä»¶ç ï¼š</text>
        <text class="value pickup-code">{{task.pickupCode}}</text>
      </view>
      
      <view wx:if="{{task.remark}}" class="info-item">
        <text class="label">å¤‡æ³¨ï¼š</text>
        <text class="value">{{task.remark}}</text>
      </view>
    </view>

    <view class="section">
      <view class="section-title">è”ç³»æ–¹å¼</view>
      <view class="contact-info">
        <view wx:if="{{task.phone}}" class="contact-item" bindtap="makePhoneCall" data-phone="{{task.phone}}">
          <text class="contact-label">ğŸ“ è”ç³»ç”µè¯ï¼š</text>
          <text class="contact-value">{{task.phone}}</text>
        </view>
        <view wx:if="{{task.wechat}}" class="contact-item" bindtap="copyWechat" data-wechat="{{task.wechat}}">
          <text class="contact-label">ğŸ’¬ å¾®ä¿¡å·ï¼š</text>
          <text class="contact-value">{{task.wechat}}</text>
        </view>
        <view wx:if="{{!task.phone && !task.wechat}}" class="contact-hint">
          <text>æœªå¡«å†™è”ç³»æ–¹å¼</text>
        </view>
      </view>
    </view>

    <!-- å‘å¸ƒè€…ä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">å‘å¸ƒè€…ä¿¡æ¯</view>
      
      <view class="user-info">
        <image class="avatar" src="{{publisher.avatar || '/images/default-avatar.png'}}" />
        <view class="user-details">
          <text class="nickname">{{publisher.nickname}}</text>
          <text class="rating">â­ {{publisher.rating}}</text>
        </view>
      </view>
      
      <!-- è”ç³»æ–¹å¼ï¼ˆæ¥å•åæ˜¾ç¤ºï¼‰ -->
      <view wx:if="{{canViewContact}}" class="contact-info">
        <view class="contact-item" bindtap="makePhoneCall" data-phone="{{publisher.phone}}">
          <text class="contact-label">ğŸ“ è”ç³»ç”µè¯ï¼š</text>
          <text class="contact-value">{{publisher.phone || 'æœªå¡«å†™'}}</text>
        </view>
        
        <view wx:if="{{publisher.wechat}}" class="contact-item">
          <text class="contact-label">ğŸ’¬ å¾®ä¿¡å·ï¼š</text>
          <text class="contact-value">{{publisher.wechat}}</text>
        </view>
      </view>
      
      <view wx:else class="contact-hint">
        <text>æ¥å•åå¯æŸ¥çœ‹è”ç³»æ–¹å¼</text>
      </view>
    </view>

    <!-- æ¥å•è€…ä¿¡æ¯ï¼ˆå¦‚æœå·²æ¥å•ï¼‰ -->
    <view wx:if="{{order && order.takerInfo}}" class="section">
      <view class="section-title">æ¥å•è€…ä¿¡æ¯</view>
      
      <view class="user-info">
        <image class="avatar" src="{{order.takerInfo.avatar || '/images/default-avatar.png'}}" />
        <view class="user-details">
          <text class="nickname">{{order.takerInfo.nickname}}</text>
          <text class="rating">â­ {{order.takerInfo.rating}}</text>
        </view>
      </view>
      
      <!-- æ¥å•è€…è”ç³»æ–¹å¼ï¼ˆä»»åŠ¡å‘å¸ƒè€…å¯è§ï¼‰ -->
      <view wx:if="{{isTaskOwner && order.takerInfo}}" class="contact-info">
        <view class="contact-item" bindtap="makePhoneCall" data-phone="{{order.takerInfo.phone}}">
          <text class="contact-label">ğŸ“ è”ç³»ç”µè¯ï¼š</text>
          <text class="contact-value">{{order.takerInfo.phone || 'æœªå¡«å†™'}}</text>
        </view>
        
        <view wx:if="{{order.takerInfo.wechat}}" class="contact-item">
          <text class="contact-label">ğŸ’¬ å¾®ä¿¡å·ï¼š</text>
          <text class="contact-value">{{order.takerInfo.wechat}}</text>
        </view>
      </view>
    </view>

    <!-- è¯„ä»·ï¼ˆä»…ä»»åŠ¡å®Œæˆåå±•ç¤ºï¼‰ -->
    <view wx:if="{{task.status === 'completed'}}" class="section">
      <view class="section-title">è¯„ä»·</view>
      <view wx:if="{{reviews.length === 0}}" class="contact-hint">
        <text>æš‚æ— è¯„ä»·</text>
      </view>
      <view wx:else>
        <view wx:for="{{reviews}}" wx:key="_id" class="review-card">
          <view class="user-info">
            <image class="avatar" src="{{item.reviewer.avatar || '/images/default-avatar.png'}}" />
            <view class="user-details">
              <text class="nickname">{{item.reviewer.nickname}}</text>
              <text class="rating">â­ {{item.rating}}</text>
            </view>
          </view>
          <view class="info-item">
            <text class="value">{{item.comment || 'æ— è¯„ä»·å†…å®¹'}}</text>
          </view>
          <view class="time-info">
            <text>{{item.createTimeText}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view wx:if="{{hasAction}}" class="action-section">
      <!-- ä»»åŠ¡å‘å¸ƒè€…è§†è§’ -->
      <block wx:if="{{isTaskOwner}}">
        <view wx:if="{{task.status === 'pending'}}" class="action-buttons">
          <button class="btn-secondary" bindtap="cancelTask">å–æ¶ˆä»»åŠ¡</button>
        </view>
        
        <view wx:if="{{task.status === 'accepted'}}" class="action-buttons">
          <button class="btn-primary" bindtap="completeTask">ç¡®è®¤å®Œæˆ</button>
        </view>
        
        <view wx:if="{{task.status === 'completed'}}" class="action-buttons">
          <button class="btn-secondary" bindtap="viewReviews">æŸ¥çœ‹è¯„ä»·</button>
        </view>
      </block>
      
      <!-- å…¶ä»–ç”¨æˆ·è§†è§’ -->
      <block wx:else>
        <view wx:if="{{task.status === 'pending'}}" class="action-buttons">
          <button class="btn-primary" bindtap="acceptTask">ç«‹å³æ¥å•</button>
        </view>
        
        <view wx:if="{{task.status === 'accepted' && isTaskTaker}}" class="action-buttons">
          <button class="btn-primary" bindtap="completeTask">ç¡®è®¤å®Œæˆ</button>
        </view>
        
        <view wx:if="{{task.status === 'completed' && isTaskTaker}}" class="action-buttons">
          <button class="btn-secondary" bindtap="viewReviews">æŸ¥çœ‹è¯„ä»·</button>
        </view>
      </block>
    </view>

    <!-- æ—¶é—´ä¿¡æ¯ -->
    <view class="time-info">
      <text>å‘å¸ƒæ—¶é—´ï¼š{{createTimeText}}</text>
      <text wx:if="{{order && order.completeTime}}">å®Œæˆæ—¶é—´ï¼š{{completeTimeText}}</text>
    </view>
  </view>
</view>
