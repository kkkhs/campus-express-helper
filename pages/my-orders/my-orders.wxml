<view class="container">
  <!-- çŠ¶æ€æ ‡ç­¾æ  -->
  <view class="status-tabs">
    <view 
      wx:for="{{statusTabs}}" 
      wx:key="key"
      class="tab-item {{activeTab === item.key ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="{{item.key}}"
    >
      <text class="tab-text">{{item.name}}</text>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view scroll-y class="order-list" refresher-enabled refresher-triggered="{{loading}}" bindrefresherrefresh="onPullDownRefresh">
    <view wx:if="{{orders.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ¤</text>
      <text class="empty-text">æš‚æ— ç›¸å…³è®¢å•</text>
    </view>

    <view wx:for="{{orders}}" wx:key="_id" class="order-card">
      <view class="card-header">
        <view class="header-left">
          <view class="location-badge">
            <text class="location-icon">ğŸ“</text>
            <text class="location-text">{{item.task.pickupPoint}}</text>
          </view>
          <view class="status-tag status-{{item.status}}">
            {{item.statusStyle.text}}
          </view>
        </view>
        <view class="reward-badge">
          <text class="reward-symbol">Â¥</text>
          <text class="reward-amount">{{item.task.reward}}</text>
        </view>
      </view>

      <view class="card-body">
        <view class="task-section">
          <view class="task-row">
            <text class="task-icon">ğŸ“¦</text>
            <text class="task-company">{{item.task.company}}</text>
          </view>
          <view class="task-row">
            <text class="task-icon">ğŸ”¢</text>
            <text class="task-code">å–ä»¶ç : {{item.task.pickupCode}}</text>
          </view>
        </view>

        <view class="publisher-section">
          <image class="publisher-avatar" src="{{item.publisher.avatar || '/images/default-avatar.png'}}" mode="aspectFill" />
          <view class="publisher-details">
            <view class="publisher-name-row">
              <text class="publisher-name">{{item.publisher.nickname}}</text>
              <text class="publisher-rating">â­ {{item.publisher.rating || '5.0'}}</text>
            </view>
            <text class="order-time">{{item.createTimeText}}</text>
          </view>
        </view>

        <view class="contact-section">
          <view class="contact-item">
            <text class="contact-icon">ğŸ“</text>
            <text class="contact-text">{{item.task.phone || 'æœªå¡«å†™'}}</text>
          </view>
          <view wx:if="{{item.task.wechat}}" class="contact-item">
            <text class="contact-icon">ğŸ’¬</text>
            <text class="contact-text">{{item.task.wechat}}</text>
          </view>
        </view>

        <view wx:if="{{item.task.remark}}" class="remark-section">
          <text class="remark-icon">ğŸ’­</text>
          <text class="remark-text">{{item.task.remark}}</text>
        </view>
      </view>

      <view class="card-footer">
        <button 
          class="btn-action btn-secondary"
          bindtap="contactPublisher"
          data-phone="{{item.task.phone}}"
          data-wechat="{{item.task.wechat}}"
        >
          <text class="btn-icon">ğŸ“±</text>
          <text>è”ç³»TA</text>
        </button>
        
        <button 
          wx:if="{{item.status === 'accepted'}}" 
          class="btn-action btn-primary"
          bindtap="completeOrder"
          data-order-id="{{item._id}}"
          data-task-id="{{item.taskId}}"
        >
          <text class="btn-icon">âœ…</text>
          <text>å®Œæˆä»»åŠ¡</text>
        </button>
        
        <button 
          wx:if="{{item.status === 'completed' && !item.reviewed}}" 
          class="btn-action btn-review"
          bindtap="goToReview"
          data-task-id="{{item.taskId}}"
          data-order-id="{{item._id}}"
          data-reviewee-id="{{item.task.userId}}"
        >
          <text class="btn-icon">â­</text>
          <text>å»è¯„ä»·</text>
        </button>
        
        <view 
          wx:if="{{item.status === 'completed' && item.reviewed}}" 
          class="btn-action btn-disabled"
        >
          <text class="btn-icon">âœ“</text>
          <text>å·²è¯„ä»·</text>
        </view>
      </view>
    </view>

    <view wx:if="{{loading && orders.length > 0}}" class="loading-more">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <view wx:if="{{!hasMore && orders.length > 0}}" class="no-more">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šè®¢å•äº†</text>
    </view>
  </scroll-view>
</view>
