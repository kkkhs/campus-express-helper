<view class="container">
  <!-- ç™»å½•å¼•å¯¼ -->
  <view wx:if="{{showLogin}}" class="login-overlay">
    <view class="login-card">
      <view class="login-icon">ğŸ‰</view>
      <view class="login-title">æ¬¢è¿ä½¿ç”¨å¿«é€’äº’åŠ©</view>
      <view class="login-desc">æˆæƒç™»å½•åå³å¯å‘å¸ƒä»»åŠ¡ã€æ¥å•èµšé…¬åŠ³</view>
      <view class="login-features">
        <view class="feature-item">
          <text class="feature-icon">ğŸ“¦</text>
          <text class="feature-text">å‘å¸ƒä»£å–</text>
        </view>
        <view class="feature-item">
          <text class="feature-icon">ğŸ’°</text>
          <text class="feature-text">èµšå–é…¬åŠ³</text>
        </view>
        <view class="feature-item">
          <text class="feature-icon">â­</text>
          <text class="feature-text">äº’ç›¸è¯„ä»·</text>
        </view>
      </view>
      <button class="btn-login" bindtap="login">
        <text class="btn-icon">âœ¨</text>
        <text>å¾®ä¿¡ä¸€é”®ç™»å½•</text>
      </button>
    </view>
  </view>
  <!-- é¡¶éƒ¨ç­›é€‰æ  -->
  <view class="filter-bar">
    <picker mode="selector" range="{{pickupPoints}}" bindchange="onPickupPointChange">
      <view class="filter-item {{pickupPoint ? 'active' : ''}}">
        <text>{{pickupPoint || 'å¿«é€’ç‚¹'}}</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>
    
    <picker mode="selector" range="{{sortOptions}}" bindchange="onSortChange">
      <view class="filter-item {{sortBy ? 'active' : ''}}">
        <text>{{sortOptions[sortIndex] || 'æ’åº'}}</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>
    
    <view class="filter-item {{showRewardFilter ? 'active' : ''}}" bindtap="toggleRewardFilter">
      <text>é…¬åŠ³</text>
      <text class="arrow">â–¼</text>
    </view>
  </view>

  <!-- é…¬åŠ³ç­›é€‰å¼¹çª— -->
  <view class="reward-filter-popup {{showRewardFilter ? 'show' : ''}}">
    <view class="popup-content">
      <view class="popup-header">
        <text>é…¬åŠ³èŒƒå›´</text>
        <text bindtap="toggleRewardFilter">âœ•</text>
      </view>
      <view class="reward-range">
        <text>Â¥{{rewardMin}}</text>
        <text>-</text>
        <text>Â¥{{rewardMax}}</text>
      </view>
      <view class="range-sliders">
        <view class="range-row">
          <text class="range-label">æœ€ä½</text>
          <slider class="range-slider" min="0" max="{{rewardMax}}" value="{{rewardMin}}" bindchange="onRewardMinChange" bindchanging="onRewardMinChanging" />
          <text class="range-val">Â¥{{rewardMin}}</text>
        </view>
        <view class="range-row">
          <text class="range-label">æœ€é«˜</text>
          <slider class="range-slider" min="{{rewardMin}}" max="50" value="{{rewardMax}}" bindchange="onRewardMaxChange" bindchanging="onRewardMaxChanging" />
          <text class="range-val">Â¥{{rewardMax}}</text>
        </view>
      </view>
      <view class="popup-buttons">
        <button class="btn-secondary" bindtap="resetRewardFilter">é‡ç½®</button>
        <button class="btn-primary" bindtap="confirmRewardFilter">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <scroll-view scroll-y class="task-list" refresher-enabled refresher-triggered="{{isRefreshing}}" bindrefresherrefresh="onRefresh">
    <view wx:if="{{tasks.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— ä»»åŠ¡</text>
      <text class="empty-subtext">å¿«å»å‘å¸ƒç¬¬ä¸€ä¸ªä»»åŠ¡å§ï¼</text>
      <view class="empty-button" bindtap="goToPublish">
        <text>ç«‹å³å‘å¸ƒ</text>
      </view>
    </view>
    
    <view wx:for="{{tasks}}" wx:key="_id" class="task-card" bindtap="goToDetail" data-task-id="{{item._id}}">
      <view class="task-header">
        <view class="task-location">
          <view class="location-icon-wrapper">
            <text class="location-icon">ğŸ“</text>
          </view>
          <view class="location-info">
            <text class="pickup-point">{{item.pickupPoint}}</text>
            <text class="company-name">{{item.company}}</text>
          </view>
        </view>
        <view class="task-reward-badge">
          <text class="reward-symbol">Â¥</text>
          <text class="reward-value">{{item.reward}}</text>
        </view>
      </view>
      
      <view class="task-body">
        <view class="info-row">
          <view class="info-item">
            <text class="info-icon">ğŸ“¦</text>
            <text class="info-text">å–ä»¶ç : {{item.pickupCode}}</text>
          </view>
        </view>
        <view wx:if="{{item.remark}}" class="task-remark">
          <text class="remark-icon">ğŸ’¬</text>
          <text class="remark-text">{{item.remark}}</text>
        </view>
      </view>
      
      <view class="task-footer">
        <view class="publisher-info">
          <image class="publisher-avatar" src="{{item.publisher.avatar || '/images/default-avatar.png'}}" mode="aspectFill" />
          <view class="publisher-details">
            <text class="publisher-name">{{item.publisher.nickname}}</text>
            <view class="publisher-meta">
              <text class="rating-text">â­ {{item.publisher.rating}}</text>
              <text class="time-text">{{item.createTimeText}}</text>
            </view>
          </view>
        </view>
        <view class="action-button">
          <text class="action-icon">ğŸ¤</text>
          <text class="action-text">æ¥å•</text>
        </view>
      </view>
    </view>
    
    <view wx:if="{{loading}}" class="loading-more">
      <text>åŠ è½½ä¸­...</text>
    </view>
    
    <view wx:if="{{!hasMore && tasks.length > 0}}" class="no-more-data">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </scroll-view>

  <!-- å‘å¸ƒæŒ‰é’®ï¼ˆç™»å½•åæ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{!showLogin}}" class="publish-btn" bindtap="goToPublish">
    <text class="plus-icon">+</text>
    <text>å‘å¸ƒä»»åŠ¡</text>
  </view>
</view>
